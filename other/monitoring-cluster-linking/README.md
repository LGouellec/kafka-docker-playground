`kafka.server:type=cluster-link-metrics,name=failed-mirror-partition-count,link-name={linkName}`
Seems not existing
https://github.com/confluentinc/ce-kafka/pull/3431/files
but this exists kafka_server_link_clusterlinkfetchermanager_failedpartitionscount
https://github.com/confluentinc/ce-kafka/blob/db0c41aa38090b70f63334d71572990c3c594f7d/core/src/main/scala/kafka/server/link/ClusterLinkFetcherManager.scala#L39

kafka.server:type=cluster-link-metrics,mode=destination,state=unavailable,link-name=link-us-to-europe

kafka.server:type=cluster-link-metrics,link-name=link-us-to-europe topic mirror-topic-lag
vs 
ConsumerLag

kafka.server<type=cluster-link-metrics, link-name=link-us-to-europe><>link-source-unavailable-rate
kafka_server_cluster_link_metrics_link_source_unavailable_total
vs
kafka_server_cluster_link_metrics_link_count{env="destination", instance="broker-europe:1234", job="kafka", link_name="link-us-to-europe", mode="destination", state="unavailable"}
https://github.com/confluentinc/ce-kafka/pull/9316


availability.check.ms
availability.check.consecutive.failure.threshold
val AvailabilityCheckMsDefault = 60 * 1000
val AvailabilityCheckConsecutiveFailureThresholdDefault = 5


AVAILABILITY_CHECK_CONSECUTIVE_FAILURE_THRESHOLD

can't get the CL description... --> 7.4

info(s"Cluster link $linkName is not available, moving to degraded state")
[2023-04-20 12:35:32,947] INFO [ClusterLinkManager-broker-1] Cluster link link-us-to-europe is not available, moving to degraded state (kafka.server.link.ClusterLinkManager)

Throughput don't get update when cluster link unavialable
Mirroring Throughput

[2023-04-20 12:27:33,224] INFO Link link-us-to-europe availability check failed 1 times (kafka.server.link.ClusterLinkCheckAvailability)
[2023-04-20 12:29:33,147] INFO Link link-us-to-europe availability check failed 2 times (kafka.server.link.ClusterLinkCheckAvailability)
[2023-04-20 12:31:33,079] INFO Link link-us-to-europe availability check failed 3 times (kafka.server.link.ClusterLinkCheckAvailability)
[2023-04-20 12:33:33,011] INFO Link link-us-to-europe availability check failed 4 times (kafka.server.link.ClusterLinkCheckAvailability)


docker exec broker-europe kafka-cluster-links --bootstrap-server broker-europe:9092 --create --link link-us-to-europe --config bootstrap.servers=broker-us:9092,metadata.max.age.ms=5000,consumer.offset.sync.enable=true,consumer.offset.sync.ms=3000,availability.check.ms=10000,availability.check.consecutive.failure.threshold=3 --consumer-group-filters-json-file /tmp/consumer.offset.sync.json


[2023-04-20 13:09:44,347] INFO [ClusterLinkManager-broker-1] ClusterLinkManager has started up. (kafka.server.link.ClusterLinkManager)
Apr 20, 2023 1:09:49 PM org.glassfish.jersey.internal.inject.Providers checkProviderRuntime
WARNING: A provider io.confluent.metadataapi.resources.MetadataResource registered in SERVER runtime does not implement any provider interfaces applicable in the SERVER runtime. Due to constraint configuration problems the provider io.confluent.metadataapi.resources.MetadataResource will be ignored.
[2023-04-20 13:11:03,846] INFO [ClusterLinkManager-broker-1] Creating cluster link with data 'linkName=link-us-to-europe, linkId=d77a9d80-90a1-43bc-9565-f6e9c756e023, clusterId=Deq2KcCEQGerZuE7JsOCeA, isDeleted=false None' (kafka.server.link.ClusterLinkManager)
[2023-04-20 13:11:03,860] INFO [ClusterLinkManager-broker-1] Creating destination cluster link linkName=link-us-to-europe, linkId=d77a9d80-90a1-43bc-9565-f6e9c756e023, clusterId=Deq2KcCEQGerZuE7JsOCeA, isDeleted=false None (kafka.server.link.ClusterLinkManager)
[2023-04-20 13:11:03,972] INFO [ClusterLinkManager-broker-1] Successfully created cluster link with data linkName=link-us-to-europe, linkId=d77a9d80-90a1-43bc-9565-f6e9c756e023, clusterId=Deq2KcCEQGerZuE7JsOCeA, isDeleted=false None (kafka.server.link.ClusterLinkManager)
[2023-04-20 13:11:04,005] INFO [ClusterLinkManager-broker-1] Reconfiguring cluster link data linkName=link-us-to-europe, linkId=d77a9d80-90a1-43bc-9565-f6e9c756e023, clusterId=Deq2KcCEQGerZuE7JsOCeA, isDeleted=false None with new config {sasl.oauthbearer.token.endpoint.url=null, sasl.oauthbearer.jwks.endpoint.refresh.ms=3600000, reconnect.backoff.max.ms=10000, auto.create.mirror.topics.filters=, consumer.offset.sync.ms=3000, ssl.engine.factory.class=null, replica.socket.receive.buffer.bytes=-1, sasl.oauthbearer.expected.audience=null, replica.fetch.wait.max.ms=500, local.sasl.oauthbearer.expected.issuer=null, ssl.keystore.type=JKS, local.sasl.kerberos.kinit.cmd=/usr/bin/kinit, local.sasl.oauthbearer.jwks.endpoint.retry.backoff.ms=100, local.sasl.login.refresh.window.factor=0.8, topic.config.sync.ms=5000, ssl.truststore.password=null, ssl.endpoint.identification.algorithm=https, replica.socket.timeout.ms=30000, local.ssl.key.password=null, local.ssl.keystore.certificate.chain=null, local.ssl.truststore.certificates=null, reverse.connection.setup.timeout.ms=60000, sasl.login.refresh.buffer.seconds=300, local.sasl.login.retry.backoff.ms=100, local.sasl.oauthbearer.sub.claim.name=sub, ssl.truststore.type=JKS, acl.sync.enable=false, sasl.oauthbearer.clock.skew.seconds=30, link.fetcher.max.lagging.partitions=-1, local.ssl.cipher.suites=null, client.dns.lookup=use_all_dns_ips, local.sasl.login.class=null, local.ssl.keystore.key=null, local.sasl.client.callback.handler.class=null, local.sasl.login.refresh.buffer.seconds=300, consumer.group.prefix.enable=false, sasl.oauthbearer.jwks.endpoint.url=null, local.ssl.keystore.location=null, availability.check.ms=60000, sasl.login.retry.backoff.ms=100, ssl.secure.random.implementation=null, local.ssl.keystore.type=JKS, sasl.kerberos.service.name=null, sasl.kerberos.ticket.renew.jitter=0.05, cluster.link.retry.timeout.ms=300000, ssl.trustmanager.algorithm=PKIX, sasl.jaas.config=null, connection.mode=null, sasl.kerberos.min.time.before.relogin=60000, cluster.link.paused=false, connections.max.idle.ms=600000, local.ssl.endpoint.identification.algorithm=https, local.sasl.oauthbearer.scope.claim.name=scope, replica.fetch.backoff.ms=1000, local.sasl.kerberos.min.time.before.relogin=60000, local.ssl.engine.factory.class=null, ssl.keystore.certificate.chain=null, socket.connection.setup.timeout.ms=10000, auto.create.mirror.topics.enable=false, ssl.provider=null, ssl.enabled.protocols=[TLSv1.2, TLSv1.3], local.sasl.oauthbearer.token.endpoint.url=null, local.sasl.login.read.timeout.ms=null, local.ssl.protocol=TLSv1.3, ssl.cipher.suites=null, link.mode=DESTINATION, security.protocol=PLAINTEXT, ssl.keymanager.algorithm=SunX509, sasl.login.callback.handler.class=null, replica.fetch.max.bytes=5242880, local.sasl.login.refresh.window.jitter=0.05, metadata.max.age.ms=5000, local.sasl.login.refresh.min.period.seconds=60, local.sasl.kerberos.service.name=null, reconnect.backoff.ms=50, sasl.kerberos.ticket.renew.window.factor=0.8, bootstrap.servers=[broker-us:9092], local.ssl.secure.random.implementation=null, local.sasl.login.callback.handler.class=null, ssl.truststore.certificates=null, num.cluster.link.fetchers=1, sasl.mechanism=GSSAPI, local.sasl.mechanism=GSSAPI, local.sasl.oauthbearer.clock.skew.seconds=30, local.ssl.keystore.password=null, request.timeout.ms=30000, sasl.login.retry.backoff.max.ms=10000, link.fetcher.enforce.max.lagging.partitions.ms=300000, local.sasl.jaas.config=null, consumer.offset.sync.enable=true, sasl.login.class=null, local.security.protocol=PLAINTEXT, local.ssl.truststore.type=JKS, local.sasl.oauthbearer.jwks.endpoint.retry.backoff.max.ms=10000, ssl.truststore.location=null, replica.fetch.response.max.bytes=10485760, ssl.keystore.password=null, sasl.login.connect.timeout.ms=null, socket.connection.setup.timeout.max.ms=30000, consumer.offset.group.filters={
[2023-04-20 13:12:30,505] INFO [ClusterLinkManager-broker-1] Creating cluster link with data 'linkName=link-us-to-europe2, linkId=192bf1f2-e6fb-47c3-b9a8-32214db52d77, clusterId=Deq2KcCEQGerZuE7JsOCeA, isDeleted=false None' (kafka.server.link.ClusterLinkManager)
[2023-04-20 13:12:30,505] INFO [ClusterLinkManager-broker-1] Creating destination cluster link linkName=link-us-to-europe2, linkId=192bf1f2-e6fb-47c3-b9a8-32214db52d77, clusterId=Deq2KcCEQGerZuE7JsOCeA, isDeleted=false None (kafka.server.link.ClusterLinkManager)
[2023-04-20 13:12:30,543] INFO [ClusterLinkManager-broker-1] Successfully created cluster link with data linkName=link-us-to-europe2, linkId=192bf1f2-e6fb-47c3-b9a8-32214db52d77, clusterId=Deq2KcCEQGerZuE7JsOCeA, isDeleted=false None (kafka.server.link.ClusterLinkManager)
[2023-04-20 13:12:30,562] INFO [ClusterLinkManager-broker-1] Reconfiguring cluster link data linkName=link-us-to-europe2, linkId=192bf1f2-e6fb-47c3-b9a8-32214db52d77, clusterId=Deq2KcCEQGerZuE7JsOCeA, isDeleted=false None with new config {sasl.oauthbearer.token.endpoint.url=null, sasl.oauthbearer.jwks.endpoint.refresh.ms=3600000, reconnect.backoff.max.ms=10000, auto.create.mirror.topics.filters=, consumer.offset.sync.ms=3000, ssl.engine.factory.class=null, replica.socket.receive.buffer.bytes=-1, sasl.oauthbearer.expected.audience=null, replica.fetch.wait.max.ms=500, local.sasl.oauthbearer.expected.issuer=null, ssl.keystore.type=JKS, local.sasl.kerberos.kinit.cmd=/usr/bin/kinit, local.sasl.oauthbearer.jwks.endpoint.retry.backoff.ms=100, local.sasl.login.refresh.window.factor=0.8, topic.config.sync.ms=5000, ssl.truststore.password=null, ssl.endpoint.identification.algorithm=https, replica.socket.timeout.ms=30000, local.ssl.key.password=null, local.ssl.keystore.certificate.chain=null, local.ssl.truststore.certificates=null, reverse.connection.setup.timeout.ms=60000, sasl.login.refresh.buffer.seconds=300, local.sasl.login.retry.backoff.ms=100, local.sasl.oauthbearer.sub.claim.name=sub, ssl.truststore.type=JKS, acl.sync.enable=false, sasl.oauthbearer.clock.skew.seconds=30, link.fetcher.max.lagging.partitions=-1, local.ssl.cipher.suites=null, client.dns.lookup=use_all_dns_ips, local.sasl.login.class=null, local.ssl.keystore.key=null, local.sasl.client.callback.handler.class=null, local.sasl.login.refresh.buffer.seconds=300, consumer.group.prefix.enable=false, sasl.oauthbearer.jwks.endpoint.url=null, local.ssl.keystore.location=null, availability.check.ms=10000, sasl.login.retry.backoff.ms=100, ssl.secure.random.implementation=null, local.ssl.keystore.type=JKS, sasl.kerberos.service.name=null, sasl.kerberos.ticket.renew.jitter=0.05, cluster.link.retry.timeout.ms=300000, ssl.trustmanager.algorithm=PKIX, sasl.jaas.config=null, connection.mode=null, sasl.kerberos.min.time.before.relogin=60000, cluster.link.paused=false, connections.max.idle.ms=600000, local.ssl.endpoint.identification.algorithm=https, local.sasl.oauthbearer.scope.claim.name=scope, replica.fetch.backoff.ms=1000, local.sasl.kerberos.min.time.before.relogin=60000, local.ssl.engine.factory.class=null, ssl.keystore.certificate.chain=null, socket.connection.setup.timeout.ms=10000, auto.create.mirror.topics.enable=false, ssl.provider=null, ssl.enabled.protocols=[TLSv1.2, TLSv1.3], local.sasl.oauthbearer.token.endpoint.url=null, local.sasl.login.read.timeout.ms=null, local.ssl.protocol=TLSv1.3, ssl.cipher.suites=null, link.mode=DESTINATION, security.protocol=PLAINTEXT, ssl.keymanager.algorithm=SunX509, sasl.login.callback.handler.class=null, replica.fetch.max.bytes=5242880, local.sasl.login.refresh.window.jitter=0.05, metadata.max.age.ms=5000, local.sasl.login.refresh.min.period.seconds=60, local.sasl.kerberos.service.name=null, reconnect.backoff.ms=50, sasl.kerberos.ticket.renew.window.factor=0.8, bootstrap.servers=[broker-us:9092], local.ssl.secure.random.implementation=null, local.sasl.login.callback.handler.class=null, ssl.truststore.certificates=null, num.cluster.link.fetchers=1, sasl.mechanism=GSSAPI, local.sasl.mechanism=GSSAPI, local.sasl.oauthbearer.clock.skew.seconds=30, local.ssl.keystore.password=null, request.timeout.ms=30000, sasl.login.retry.backoff.max.ms=10000, link.fetcher.enforce.max.lagging.partitions.ms=300000, local.sasl.jaas.config=null, consumer.offset.sync.enable=true, sasl.login.class=null, local.security.protocol=PLAINTEXT, local.ssl.truststore.type=JKS, local.sasl.oauthbearer.jwks.endpoint.retry.backoff.max.ms=10000, ssl.truststore.location=null, replica.fetch.response.max.bytes=10485760, ssl.keystore.password=null, sasl.login.connect.timeout.ms=null, socket.connection.setup.timeout.max.ms=30000, consumer.offset.group.filters={
^[

# availability.check.ms=60000 how ever 2mins
➜  ~ docker logs -f broker-europe | grep "ClusterLinkCheckAvailability"
Apr 20, 2023 1:21:09 PM org.glassfish.jersey.internal.inject.Providers checkProviderRuntime
WARNING: A provider io.confluent.metadataapi.resources.MetadataResource registered in SERVER runtime does not implement any provider interfaces applicable in the SERVER runtime. Due to constraint configuration problems the provider io.confluent.metadataapi.resources.MetadataResource will be ignored.
[2023-04-20 13:35:05,235] INFO Link link-us-to-europe availability check failed 1 times (kafka.server.link.ClusterLinkCheckAvailability)
	at kafka.server.link.ClusterLinkCheckAvailability.handleResult(ClusterLinkCheckAvailability.scala:28)
	at kafka.server.link.ClusterLinkCheckAvailability.$anonfun$run$1(ClusterLinkCheckAvailability.scala:20)
[2023-04-20 13:37:05,171] INFO Link link-us-to-europe availability check failed 2 times (kafka.server.link.ClusterLinkCheckAvailability)
	at kafka.server.link.ClusterLinkCheckAvailability.handleResult(ClusterLinkCheckAvailability.scala:28)
	at kafka.server.link.ClusterLinkCheckAvailability.$anonfun$run$1(ClusterLinkCheckAvailability.scala:20)
[2023-04-20 13:39:05,105] INFO Link link-us-to-europe availability check failed 3 times (kafka.server.link.ClusterLinkCheckAvailability)
	at kafka.server.link.ClusterLinkCheckAvailability.handleResult(ClusterLinkCheckAvailability.scala:28)
	at kafka.server.link.ClusterLinkCheckAvailability.$anonfun$run$1(ClusterLinkCheckAvailability.scala:20)
[2023-04-20 13:41:05,038] INFO Link link-us-to-europe availability check failed 4 times (kafka.server.link.ClusterLinkCheckAvailability)
	at kafka.server.link.ClusterLinkCheckAvailability.handleResult(ClusterLinkCheckAvailability.scala:28)
	at kafka.server.link.ClusterLinkCheckAvailability.$anonfun$run$1(ClusterLinkCheckAvailability.scala:20)


  [2023-04-20 14:37:05,369] INFO [ClusterLinkManager-broker-1] Reconfiguring cluster link data linkName=link-us-to-europe, linkId=82ef047a-a606-4748-a1b5-5cfb4ccf8552, clusterId=kPWpb4MURbCieB76wmYeNA, isDeleted=false None with new config {sasl.oauthbearer.token.endpoint.url=null, sasl.oauthbearer.jwks.endpoint.refresh.ms=3600000, reconnect.backoff.max.ms=10000, auto.create.mirror.topics.filters=, consumer.offset.sync.ms=3000, ssl.engine.factory.class=null, replica.socket.receive.buffer.bytes=-1, sasl.oauthbearer.expected.audience=null, replica.fetch.wait.max.ms=500, local.sasl.oauthbearer.expected.issuer=null, ssl.keystore.type=JKS, local.sasl.kerberos.kinit.cmd=/usr/bin/kinit, local.sasl.oauthbearer.jwks.endpoint.retry.backoff.ms=100, local.sasl.login.refresh.window.factor=0.8, topic.config.sync.ms=5000, ssl.truststore.password=null, ssl.endpoint.identification.algorithm=https, replica.socket.timeout.ms=30000, local.ssl.key.password=null, local.ssl.keystore.certificate.chain=null, local.ssl.truststore.certificates=null, reverse.connection.setup.timeout.ms=60000, sasl.login.refresh.buffer.seconds=300, local.sasl.login.retry.backoff.ms=100, local.sasl.oauthbearer.sub.claim.name=sub, ssl.truststore.type=JKS, acl.sync.enable=false, sasl.oauthbearer.clock.skew.seconds=30, link.fetcher.max.lagging.partitions=-1, local.ssl.cipher.suites=null, client.dns.lookup=use_all_dns_ips, local.sasl.login.class=null, local.ssl.keystore.key=null, local.sasl.client.callback.handler.class=null, local.sasl.login.refresh.buffer.seconds=300, consumer.group.prefix.enable=false, sasl.oauthbearer.jwks.endpoint.url=null, local.ssl.keystore.location=null, availability.check.ms=5000, sasl.login.retry.backoff.ms=100, ssl.secure.random.implementation=null, local.ssl.keystore.type=JKS, sasl.kerberos.service.name=null, sasl.kerberos.ticket.renew.jitter=0.05, cluster.link.retry.timeout.ms=300000, ssl.trustmanager.algorithm=PKIX, sasl.jaas.config=null, connection.mode=null, sasl.kerberos.min.time.before.relogin=60000, cluster.link.paused=false, connections.max.idle.ms=600000, local.ssl.endpoint.identification.algorithm=https, local.sasl.oauthbearer.scope.claim.name=scope, replica.fetch.backoff.ms=1000, local.sasl.kerberos.min.time.before.relogin=60000, local.ssl.engine.factory.class=null, ssl.keystore.certificate.chain=null, socket.connection.setup.timeout.ms=10000, auto.create.mirror.topics.enable=false, ssl.provider=null, ssl.enabled.protocols=[TLSv1.2, TLSv1.3], local.sasl.oauthbearer.token.endpoint.url=null, local.sasl.login.read.timeout.ms=null, local.ssl.protocol=TLSv1.3, ssl.cipher.suites=null, link.mode=DESTINATION, security.protocol=PLAINTEXT, ssl.keymanager.algorithm=SunX509, sasl.login.callback.handler.class=null, replica.fetch.max.bytes=5242880, local.sasl.login.refresh.window.jitter=0.05, metadata.max.age.ms=5000, local.sasl.login.refresh.min.period.seconds=60, local.sasl.kerberos.service.name=null, reconnect.backoff.ms=50, sasl.kerberos.ticket.renew.window.factor=0.8, bootstrap.servers=[broker-us:9092], local.ssl.secure.random.implementation=null, local.sasl.login.callback.handler.class=null, ssl.truststore.certificates=null, num.cluster.link.fetchers=1, sasl.mechanism=GSSAPI, local.sasl.mechanism=GSSAPI, local.sasl.oauthbearer.clock.skew.seconds=30, local.ssl.keystore.password=null, request.timeout.ms=30000, sasl.login.retry.backoff.max.ms=10000, link.fetcher.enforce.max.lagging.partitions.ms=300000, local.sasl.jaas.config=null, consumer.offset.sync.enable=true, sasl.login.class=null, local.security.protocol=PLAINTEXT, local.ssl.truststore.type=JKS, local.sasl.oauthbearer.jwks.endpoint.retry.backoff.max.ms=10000, ssl.truststore.location=null, replica.fetch.response.max.bytes=10485760, ssl.keystore.password=null, sasl.login.connect.timeout.ms=null, socket.connection.setup.timeout.max.ms=30000, consumer.offset.group.filters={
}, sasl.login.refresh.window.factor=0.8, sasl.login.refresh.min.period.seconds=60, sasl.oauthbearer.scope.claim.name=scope, local.listener.name=PLAINTEXT, local.sasl.kerberos.ticket.renew.jitter=0.05, sasl.oauthbearer.expected.issuer=null, sasl.login.read.timeout.ms=null, topic.config.sync.include=[min.compaction.lag.ms, max.compaction.lag.ms, message.timestamp.difference.max.ms, max.message.bytes, retention.bytes, retention.ms, delete.retention.ms, cleanup.policy, message.timestamp.type], retry.backoff.ms=100, sasl.kerberos.kinit.cmd=/usr/bin/kinit, local.sasl.oauthbearer.expected.audience=null, local.ssl.truststore.location=null, cluster.link.prefix=null, local.sasl.oauthbearer.jwks.endpoint.url=null, link.fetcher.flow.control=0, ssl.key.password=null, local.ssl.enabled.protocols=[TLSv1.2, TLSv1.3], ssl.keystore.key=null, sasl.client.callback.handler.class=null, confluent.replica.fetch.backoff.max.ms=1000, local.sasl.kerberos.ticket.renew.window.factor=0.8, link.fetcher.lagging.partition.ms=300000, ssl.protocol=TLSv1.3, acl.filters=, local.ssl.provider=null, local.ssl.trustmanager.algorithm=PKIX, ssl.keystore.location=null, replica.fetch.min.bytes=1, sasl.oauthbearer.sub.claim.name=sub, local.sasl.login.connect.timeout.ms=null, local.sasl.login.retry.backoff.max.ms=10000, sasl.oauthbearer.jwks.endpoint.retry.backoff.ms=100, local.ssl.truststore.password=null, local.sasl.oauthbearer.jwks.endpoint.refresh.ms=3600000, acl.sync.ms=5000, sasl.oauthbearer.jwks.endpoint.retry.backoff.max.ms=10000, availability.check.consecutive.failure.threshold=3, sasl.login.refresh.window.jitter=0.05, local.ssl.keymanager.algorithm=SunX509} (kafka.server.link.ClusterLinkManager)